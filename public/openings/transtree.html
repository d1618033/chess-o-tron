<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}

</style>
</head>

<body>

<button id="force">Force</button>
<button id="tree">Tree</button>
<svg></svg>

<script src="//d3js.org/d3.v4.min.js">
</script>

<script>
	var mystratify = d3.stratify;
</script>
	
	
<script src="//d3js.org/d3.v3.min.js"></script>
<script>


		var graphdata = {
			"directed": true,
			"multigraph": true,
			"graph": [],
			"nodes": [{
				"size": 5,
				"score": 0.5,
				"id": "Start",
				"type": "diamond"
			}, {
				"size": 48,
				"score": 0.5520833333333334,
				"eval": 0.5457142857142857,
				"id": "e4",
				"type": "circle"
			}, {
				"size": 42,
				"score": 0.5625,
				"eval": 0.5628571428571428,
				"id": "e5",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.5625,
				"eval": 0.3952380952380952,
				"id": "f4",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.75,
				"eval": 0.5,
				"id": "d5",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.75,
				"eval": 0.4676190476190476,
				"id": "exd5",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0.5,
				"eval": 0.4828571428571429,
				"id": "exf4",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.5,
				"eval": 0.46190476190476193,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "Bg4",
				"url": "https://lichess.org/mBzblkhm/white",
				"type": "cross"
			}, {
				"size": 42,
				"score": 0.4444444444444444,
				"eval": 0.5495238095238095,
				"id": "c5",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.4444444444444444,
				"eval": 0.5095238095238095,
				"id": "f4",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.5,
				"eval": 0.5,
				"id": "d5",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.5,
				"eval": 0.5,
				"id": "exd5",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "Qxd5",
				"url": "https://lichess.org/MY0Ztt0X/white",
				"type": "cross"
			}, {
				"size": 30,
				"score": 0.53125,
				"eval": 0.42952380952380953,
				"id": "exf4",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.53125,
				"eval": 0.4523809523809524,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0.75,
				"eval": 0.44857142857142857,
				"id": "g5",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.75,
				"eval": 0.35714285714285715,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 6,
				"score": 1,
				"eval": 0.8066666666666666,
				"id": "Bc5",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "d4",
				"url": "https://lichess.org/uEHrpl7x/white",
				"type": "cross"
			}, {
				"size": 30,
				"score": 0.6666666666666666,
				"eval": 0.5,
				"id": "d6",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.6666666666666666,
				"eval": 0.5,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 18,
				"score": 1,
				"eval": 0.5,
				"id": "Bg4",
				"type": "circle"
			}, {
				"size": 12,
				"score": 1,
				"eval": 0.5,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "h6",
				"url": "https://lichess.org/jZ6zG4ji/white",
				"type": "cross"
			}, {
				"size": 30,
				"score": 0.5,
				"eval": 0.5171428571428571,
				"id": "Nc6",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.5,
				"eval": 0.5095238095238095,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0.25,
				"eval": 0.4961904761904762,
				"id": "e6",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.25,
				"eval": 0.319047619047619,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nge7",
				"url": "https://lichess.org/zX8JMeoM/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0.5,
				"id": "h6",
				"url": "https://lichess.org/T2FFG8Ox/white",
				"type": "cross"
			}, {
				"size": 6,
				"score": 0.75,
				"eval": 0.6085714285714285,
				"id": "d6",
				"type": "circle"
			}, {
				"size": 0,
				"score": 0.75,
				"eval": 0.32666666666666666,
				"id": "O-O",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "g4",
				"url": "https://lichess.org/8LCpsegL/white",
				"type": "cross"
			}, {
				"size": 42,
				"score": 0.75,
				"eval": 0.6238095238095238,
				"id": "d5",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.75,
				"eval": 0.3895238095238095,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.75,
				"eval": 0.3780952380952381,
				"id": "dxe4",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.75,
				"eval": 0.38571428571428573,
				"id": "Ng5",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "f5",
				"url": "https://lichess.org/b9Ro5OOV/white",
				"type": "cross"
			}, {
				"size": 6,
				"score": 0.5,
				"eval": 0.5057142857142857,
				"id": "a6",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "a3",
				"url": "https://lichess.org/5qIhi8Lv/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "e4",
				"url": "https://lichess.org/Qp19ACCz/white",
				"type": "cross"
			}, {
				"size": 42,
				"score": 0.8,
				"eval": 0.5628571428571428,
				"id": "c6",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.8,
				"eval": 0.5038095238095238,
				"id": "f4",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.8,
				"eval": 0.49047619047619045,
				"id": "d5",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.8,
				"eval": 0.44857142857142857,
				"id": "exd5",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0.8,
				"eval": 0.43142857142857144,
				"id": "cxd5",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.6666666666666666,
				"eval": 0.42952380952380953,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 6,
				"score": 1,
				"eval": 0.5,
				"id": "Bg4",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "Be2",
				"url": "https://lichess.org/MR5JMDiL/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Bb5+",
				"url": "https://lichess.org/vyyhZdxL/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "h6",
				"url": "https://lichess.org/jUZndAd7/white",
				"type": "cross"
			}, {
				"size": 18,
				"score": 1,
				"eval": 0.4942857142857143,
				"id": "Nf6",
				"type": "circle"
			}, {
				"size": 12,
				"score": 1,
				"eval": 0.320952380952381,
				"id": "d3",
				"type": "circle"
			}, {
				"size": 6,
				"score": 1,
				"eval": 0.34952380952380957,
				"id": "exd3",
				"type": "circle"
			}, {
				"size": 0,
				"score": 1,
				"eval": 0.3742857142857143,
				"id": "Bxd3",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "h6",
				"url": "https://lichess.org/oq2CQXSP/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "h6",
				"url": "https://lichess.org/Gbfeur4J/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nf6",
				"url": "https://lichess.org/sJr9gtSl/white",
				"type": "cross"
			}, {
				"size": 12,
				"score": 1,
				"eval": 0.5,
				"id": "Nc3",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "d4",
				"url": "https://lichess.org/KValunyl/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nc6",
				"url": "https://lichess.org/iT2LGMKE/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "d6",
				"url": "https://lichess.org/oiyzoAuD/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Bxf3",
				"url": "https://lichess.org/RBOTXsgP/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "b6",
				"url": "https://lichess.org/P7ShI0SI/white",
				"type": "cross"
			}, {
				"size": 18,
				"score": 0.5,
				"eval": 0.43333333333333335,
				"id": "Be7",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.5,
				"eval": 0.42,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 6,
				"score": 0.5,
				"eval": 0.48857142857142855,
				"id": "Bh4+",
				"type": "circle"
			}, {
				"size": 0,
				"score": 0.5,
				"eval": 0.37238095238095237,
				"id": "g3",
				"type": "circle"
			}, {
				"size": -1,
				"score": 0.5,
				"eval": 0.4066666666666667,
				"id": "fxg3",
				"type": "circle"
			}, {
				"size": -1,
				"score": 0.5,
				"eval": 0.35333333333333333,
				"id": "O-O",
				"type": "circle"
			}, {
				"size": -1,
				"score": 0.5,
				"eval": 0.39142857142857146,
				"id": "gxh2+",
				"type": "circle"
			}, {
				"size": -1,
				"score": 0.5,
				"eval": 0.38,
				"id": "Kh1",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nc6",
				"url": "https://lichess.org/pN1vRw8B/white",
				"type": "cross"
			}, {
				"size": 42,
				"score": 0.3333333333333333,
				"eval": 0.5,
				"id": "e6",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.3333333333333333,
				"eval": 0.5,
				"id": "f4",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.3333333333333333,
				"eval": 0.5,
				"id": "d5",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.3333333333333333,
				"eval": 0.5,
				"id": "exd5",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0,
				"eval": 0.5,
				"id": "exd5",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0,
				"eval": 0.5,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "Bg4",
				"url": "https://lichess.org/NwSwRE4f/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "g6",
				"url": "https://lichess.org/69pkLAVy/white",
				"type": "cross"
			}, {
				"size": 18,
				"score": 0.5,
				"eval": 0.5,
				"id": "Nc6",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.5,
				"eval": 0.5,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "d6",
				"url": "https://lichess.org/B97wZuT8/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Nf6",
				"url": "https://lichess.org/F8dPRfUg/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "d5",
				"url": "https://lichess.org/TLrpGfn5/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Bd6",
				"url": "https://lichess.org/yMmXaUzy/white",
				"type": "cross"
			}, {
				"size": 18,
				"score": 1,
				"eval": 0.5,
				"id": "d6",
				"type": "circle"
			}, {
				"size": 12,
				"score": 1,
				"eval": 0.5,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 1,
				"score": 1,
				"id": "e6",
				"url": "https://lichess.org/d3wZJote/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0.5,
				"id": "h6",
				"url": "https://lichess.org/HA4k3eRH/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nf6",
				"url": "https://lichess.org/pP3LJry8/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "e6",
				"url": "https://lichess.org/4AO42njF/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "O-O",
				"url": "https://lichess.org/A0v46drB/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0.5,
				"id": "h5",
				"url": "https://lichess.org/plAwKEgV/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nc6",
				"url": "https://lichess.org/FT3tUoKI/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Bxf7+",
				"url": "https://lichess.org/QyZjecWg/white",
				"type": "cross"
			}, {
				"size": 42,
				"score": 0.5,
				"eval": 0.5,
				"id": "g6",
				"type": "circle"
			}, {
				"size": 36,
				"score": 0.5,
				"eval": 0.5,
				"id": "f4",
				"type": "circle"
			}, {
				"size": 30,
				"score": 0.5,
				"eval": 0.5,
				"id": "Bg7",
				"type": "circle"
			}, {
				"size": 24,
				"score": 0.5,
				"eval": 0.5,
				"id": "Nf3",
				"type": "circle"
			}, {
				"size": 18,
				"score": 0.5,
				"eval": 0.5,
				"id": "d6",
				"type": "circle"
			}, {
				"size": 12,
				"score": 0.5,
				"eval": 0.5,
				"id": "Bc4",
				"type": "circle"
			}, {
				"size": 6,
				"score": 0.5,
				"eval": 0.5,
				"id": "Nf6",
				"type": "circle"
			}, {
				"size": 0,
				"score": 0.5,
				"eval": 0.5,
				"id": "d3",
				"type": "circle"
			}, {
				"size": -1,
				"score": 0.5,
				"eval": 0.5,
				"id": "Nc6",
				"type": "circle"
			}, {
				"size": 1,
				"score": 0,
				"id": "O-O",
				"url": "https://lichess.org/4S1RU4r2/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "e6",
				"url": "https://lichess.org/6TgUJHPR/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "d6",
				"url": "https://lichess.org/52d9iyRS/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "c3",
				"url": "https://lichess.org/cMoTE5nj/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Qxd5",
				"url": "https://lichess.org/hxt2LSFd/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nf6",
				"url": "https://lichess.org/mCE5sVqj/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "f5",
				"url": "https://lichess.org/qSA0Uu7w/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Bg4",
				"url": "https://lichess.org/eIAhjUqR/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "Nf6",
				"url": "https://lichess.org/ZrDyJrLj/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Nf6",
				"url": "https://lichess.org/DJDaqet5/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 1,
				"id": "Qxd5",
				"url": "https://lichess.org/4NQmyR06/white",
				"type": "cross"
			}, {
				"size": 1,
				"score": 0,
				"id": "d6",
				"url": "https://lichess.org/iVXWHVOM/white",
				"type": "cross"
			}],
			"links": [{
				"source": 0,
				"target": 1
			}, {
				"source": 1,
				"target": 2
			}, {
				"source": 2,
				"target": 3
			}, {
				"source": 3,
				"target": 4
			}, {
				"source": 4,
				"target": 5
			}, {
				"source": 5,
				"target": 6
			}, {
				"source": 6,
				"target": 7
			}, {
				"source": 7,
				"target": 8
			}, {
				"source": 1,
				"target": 9
			}, {
				"source": 9,
				"target": 10
			}, {
				"source": 10,
				"target": 11
			}, {
				"source": 11,
				"target": 12
			}, {
				"source": 12,
				"target": 13
			}, {
				"source": 3,
				"target": 14
			}, {
				"source": 14,
				"target": 15
			}, {
				"source": 15,
				"target": 16
			}, {
				"source": 16,
				"target": 17
			}, {
				"source": 17,
				"target": 18
			}, {
				"source": 18,
				"target": 19
			}, {
				"source": 3,
				"target": 20
			}, {
				"source": 20,
				"target": 21
			}, {
				"source": 21,
				"target": 22
			}, {
				"source": 22,
				"target": 23
			}, {
				"source": 23,
				"target": 24
			}, {
				"source": 10,
				"target": 25
			}, {
				"source": 25,
				"target": 26
			}, {
				"source": 26,
				"target": 27
			}, {
				"source": 27,
				"target": 28
			}, {
				"source": 28,
				"target": 29
			}, {
				"source": 15,
				"target": 30
			}, {
				"source": 17,
				"target": 31
			}, {
				"source": 31,
				"target": 32
			}, {
				"source": 32,
				"target": 33
			}, {
				"source": 1,
				"target": 34
			}, {
				"source": 34,
				"target": 35
			}, {
				"source": 35,
				"target": 36
			}, {
				"source": 36,
				"target": 37
			}, {
				"source": 37,
				"target": 38
			}, {
				"source": 28,
				"target": 39
			}, {
				"source": 39,
				"target": 40
			}, {
				"source": 5,
				"target": 41
			}, {
				"source": 1,
				"target": 42
			}, {
				"source": 42,
				"target": 43
			}, {
				"source": 43,
				"target": 44
			}, {
				"source": 44,
				"target": 45
			}, {
				"source": 45,
				"target": 46
			}, {
				"source": 46,
				"target": 47
			}, {
				"source": 47,
				"target": 48
			}, {
				"source": 48,
				"target": 49
			}, {
				"source": 48,
				"target": 50
			}, {
				"source": 17,
				"target": 51
			}, {
				"source": 37,
				"target": 52
			}, {
				"source": 52,
				"target": 53
			}, {
				"source": 53,
				"target": 54
			}, {
				"source": 54,
				"target": 55
			}, {
				"source": 55,
				"target": 56
			}, {
				"source": 37,
				"target": 57
			}, {
				"source": 12,
				"target": 58
			}, {
				"source": 46,
				"target": 59
			}, {
				"source": 59,
				"target": 60
			}, {
				"source": 3,
				"target": 61
			}, {
				"source": 15,
				"target": 62
			}, {
				"source": 23,
				"target": 63
			}, {
				"source": 15,
				"target": 64
			}, {
				"source": 15,
				"target": 65
			}, {
				"source": 65,
				"target": 66
			}, {
				"source": 66,
				"target": 67
			}, {
				"source": 67,
				"target": 68
			}, {
				"source": 68,
				"target": 69
			}, {
				"source": 69,
				"target": 70
			}, {
				"source": 70,
				"target": 71
			}, {
				"source": 71,
				"target": 72
			}, {
				"source": 72,
				"target": 73
			}, {
				"source": 1,
				"target": 74
			}, {
				"source": 74,
				"target": 75
			}, {
				"source": 75,
				"target": 76
			}, {
				"source": 76,
				"target": 77
			}, {
				"source": 77,
				"target": 78
			}, {
				"source": 78,
				"target": 79
			}, {
				"source": 79,
				"target": 80
			}, {
				"source": 59,
				"target": 81
			}, {
				"source": 15,
				"target": 82
			}, {
				"source": 82,
				"target": 83
			}, {
				"source": 83,
				"target": 84
			}, {
				"source": 17,
				"target": 85
			}, {
				"source": 15,
				"target": 86
			}, {
				"source": 79,
				"target": 87
			}, {
				"source": 26,
				"target": 88
			}, {
				"source": 88,
				"target": 89
			}, {
				"source": 89,
				"target": 90
			}, {
				"source": 83,
				"target": 91
			}, {
				"source": 7,
				"target": 92
			}, {
				"source": 55,
				"target": 93
			}, {
				"source": 39,
				"target": 94
			}, {
				"source": 32,
				"target": 95
			}, {
				"source": 21,
				"target": 96
			}, {
				"source": 18,
				"target": 97
			}, {
				"source": 1,
				"target": 98
			}, {
				"source": 98,
				"target": 99
			}, {
				"source": 99,
				"target": 100
			}, {
				"source": 100,
				"target": 101
			}, {
				"source": 101,
				"target": 102
			}, {
				"source": 102,
				"target": 103
			}, {
				"source": 103,
				"target": 104
			}, {
				"source": 104,
				"target": 105
			}, {
				"source": 105,
				"target": 106
			}, {
				"source": 106,
				"target": 107
			}, {
				"source": 10,
				"target": 108
			}, {
				"source": 28,
				"target": 109
			}, {
				"source": 106,
				"target": 110
			}, {
				"source": 77,
				"target": 111
			}, {
				"source": 47,
				"target": 112
			}, {
				"source": 83,
				"target": 113
			}, {
				"source": 89,
				"target": 114
			}, {
				"source": 15,
				"target": 115
			}, {
				"source": 72,
				"target": 116
			}, {
				"source": 5,
				"target": 117
			}, {
				"source": 1,
				"target": 118
			}]
		};



		// convert the flat data into a hierarchy 
		var treeData = mystratify()
			.id(function(d) {
				return d.target;
			})
			.parentId(function(d) {
				return d.source === 0 ? null : d.source;
			})
			(graphdata.links);

		// assign the name to each node
		treeData.each(function(d) {
			d.name = graphdata.nodes[d.id].id;
		});
//console.log(JSON.stringify(treeData))
var width = 960,
    height = 1000;

var linkPaths, nodeGroups, circles;		// SVG elements
var nodes, links;                     // nodes, links lists
var jsonData;                         // store imported JSON for recalculation of layouts
var force = force = d3.layout.force(); 

// tree layout
var tree = d3.layout.tree()
    .size([height, width - 160]);

// svg drawing function for link paths
var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [d.y, d.x]; });

var svg = d3.select("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(40,0)");

start(treeData);

function start(json) {
  jsonData = json;			              // store JSON data
  var nodes = tree.nodes(json),       // create the nodes array
      links = tree.links(nodes);      // creates the links array

  linkPaths = svg.selectAll("path.link")
      .data(links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", diagonal);

  nodeGroups = svg.selectAll("g.node")
      .data(nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })

  circles = nodeGroups.append("circle")
      .attr("r", 4.5);

  nodeGroups.append("text")
      .attr("dx", function(d) { return d.children ? -8 : 8; })
      .attr("dy", 3)
      .attr("text-anchor", function(d) { return d.children ? "end" : "start"; })
      .text(function(d) { return d.name; });
      
  force
    //linkDistance(50)
		.size([width, height])
		.nodes(nodes)                 // reuse tree.nodes()
		.links(links)					        // reuse tree.links()
		.charge(-340)
		.on("tick", function(e) {		  // update force layout
			nodeGroups.attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
			linkPaths.attr("d", diagonal);
		});
}


// switch to Force Layout
var layoutForce = function() {
//	circles.transition()
//		.duration(1000)
//		.attr("r", 10);
		
	force.start();
}

// switch to Tree Layout
var layoutTree = function() {
	force.stop();
	
	var delay = 1000;
	
	tree.nodes(jsonData);  	// recalculate tree layout
	
	circles.transition()
		.duration(delay/2)
		.attr("r", 4.5);
		
	// transition node groups
	nodeGroups.transition()
		.duration(delay)
			.attr("transform", function(d, i) { 
				delete d.px;	// delete px, py to get cleaner subsequent switches from tree to force
				delete d.py;
				return "translate(" + d.y + "," + d.x + ")";
			});
			
	// transition link paths
	linkPaths.transition()
		.duration(delay)
		.attr("d", diagonal);
}


// match gist frame with vis height
d3.select(self.frameElement).style("height", height + "px");

d3.select("#force").on("click", function() {
  layoutForce();
});

d3.select("#tree").on("click", function() {
  layoutTree();
});

</script>


</body>
</html>